<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Team Performance Report</title>
  <link rel="icon" href="https://spyne-prod-ai.s3.us-east-1.amazonaws.com/ai-dataset/2025/favicon.ico" type="image/x-icon" />
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.2/papaparse.min.js"></script>
  <style>
    body {
      font-family: 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      background: linear-gradient(135deg, #f5f7fa 0%, #e4edf5 100%);
      margin: 0;
      padding: 20px;
      min-height: 100vh;
      color: #333;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 20px;
    }

    header {
      text-align: center;
      margin-bottom: 30px;
      padding: 25px;
      background: linear-gradient(135deg, #1a1f2e 0%, #2c3e50 100%);
      border-radius: 16px;
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
      color: white;
    }

    h1 {
      margin: 0;
      font-size: 36px;
      font-weight: 700;
      letter-spacing: 0.5px;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    }

    .subtitle {
      margin-top: 8px;
      font-size: 18px;
      opacity: 0.9;
    }

    .dashboard {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 25px;
      margin-bottom: 30px;
    }

    .card {
      background: white;
      border-radius: 16px;
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.08);
      padding: 25px;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    .card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, #3498db, #2c3e50);
    }

    .card:hover {
      transform: translateY(-8px);
      box-shadow: 0 12px 30px rgba(0, 0, 0, 0.15);
    }

    .card-header {
      display: flex;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 2px solid #f0f4f8;
    }

    .card-icon {
      width: 48px;
      height: 48px;
      background: linear-gradient(135deg, #3498db 0%, #1a5d99 100%);
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-right: 15px;
      box-shadow: 0 4px 8px rgba(52, 152, 219, 0.3);
    }

    .card-icon svg {
      width: 24px;
      height: 24px;
      fill: white;
    }

    .card h2 {
      margin: 0;
      font-size: 20px;
      font-weight: 700;
      color: #2c3e50;
    }

    .card-content {
      max-height: 400px;
      overflow-y: auto;
      padding-right: 10px;
    }

    .card-content::-webkit-scrollbar {
      width: 6px;
    }

    .card-content::-webkit-scrollbar-track {
      background: #f1f1f1;
      border-radius: 10px;
    }

    .card-content::-webkit-scrollbar-thumb {
      background: #3498db;
      border-radius: 10px;
    }

    .name-value {
      display: flex;
      justify-content: space-between;
      padding: 12px 0;
      border-bottom: 1px solid #f0f4f8;
      transition: background-color 0.2s;
    }

    .name-value:hover {
      background-color: #f8fcff;
    }

    .name-value:last-child {
      border-bottom: none;
    }

    .name {
      font-weight: 600;
      color: #34495e;
    }

    .value {
      font-weight: 700;
      color: #2980b9;
    }

    .filters {
      display: flex;
      justify-content: space-between;
      background: white;
      padding: 20px;
      border-radius: 16px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
      margin-bottom: 30px;
      flex-wrap: wrap;
      gap: 20px;
    }

    .filter-group {
      display: flex;
      flex-direction: column;
      gap: 10px;
      min-width: 200px;
      flex: 1;
    }

    .filter-group label {
      font-weight: 600;
      color: #2c3e50;
      font-size: 14px;
    }

    .filter-group input,
    .filter-group select {
      padding: 12px;
      border-radius: 10px;
      border: 1px solid #dce4ec;
      font-size: 14px;
      transition: border-color 0.3s;
      background: #f8fafc;
    }

    .filter-group input:focus,
    .filter-group select:focus {
      outline: none;
      border-color: #3498db;
      box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
    }

    .dropdown-container {
      position: relative;
      flex: 1;
    }

    .dropdown-button {
      background: linear-gradient(135deg, #1a1f2e 0%, #2c3e50 100%);
      color: white;
      padding: 12px 20px;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      font-size: 16px;
      width: 100%;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
    }

    .dropdown-button:hover {
      background: linear-gradient(135deg, #2c3e50 0%, #1a1f2e 100%);
    }

    .dropdown-menu {
      display: none;
      position: absolute;
      background-color: white;
      border-radius: 12px;
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
      padding: 15px;
      z-index: 100;
      width: 100%;
      top: 60px;
      max-height: 300px;
      overflow-y: auto;
    }

    .dropdown-menu label {
      display: block;
      padding: 10px 12px;
      cursor: pointer;
      border-radius: 8px;
      transition: background-color 0.2s;
    }

    .dropdown-menu label:hover {
      background-color: #f0f7ff;
    }

    .apply-button {
      background: linear-gradient(135deg, #3498db 0%, #1a5d99 100%);
      color: white;
      border: none;
      border-radius: 10px;
      padding: 12px 25px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      box-shadow: 0 4px 10px rgba(52, 152, 219, 0.3);
      align-self: flex-end;
      height: 44px;
      width: 100%;
    }

    .apply-button:hover {
      background: linear-gradient(135deg, #2980b9 0%, #154a75 100%);
      transform: translateY(-2px);
      box-shadow: 0 6px 15px rgba(52, 152, 219, 0.4);
    }

    .table-container {
      background: white;
      border-radius: 16px;
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.08);
      overflow: hidden;
      margin-bottom: 40px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      background: white;
    }

    th, td {
      padding: 16px 20px;
      text-align: center;
      border-bottom: 1px solid #f0f4f8;
    }

    th {
      background: linear-gradient(135deg, #3498db 0%, #1a5d99 100%);
      color: white;
      font-weight: 600;
      position: sticky;
      top: 0;
      cursor: pointer;
      transition: background-color 0.3s;
    }

    th:hover {
      background: linear-gradient(135deg, #2980b9 0%, #154a75 100%);
    }

    tbody tr {
      transition: background-color 0.2s;
    }

    tbody tr:hover {
      background-color: #f8fcff;
    }

    tbody tr:nth-child(even) {
      background-color: #f9fbfd;
    }

    tbody tr:nth-child(even):hover {
      background-color: #f0f7ff;
    }

    .name-count {
      font-weight: 600;
      margin-left: 10px;
      background: #3498db;
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 14px;
    }

    .summary {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 20px;
      margin-bottom: 30px;
    }

    .summary-card {
      background: white;
      border-radius: 16px;
      padding: 25px;
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.08);
      text-align: center;
      transition: transform 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    .summary-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, #3498db, #2c3e50);
    }

    .summary-card:hover {
      transform: translateY(-5px);
    }

    .summary-card h3 {
      margin-top: 0;
      margin-bottom: 15px;
      color: #7f8c8d;
      font-size: 16px;
      font-weight: 600;
    }

    .summary-value {
      font-size: 32px;
      font-weight: 700;
      color: #2c3e50;
      margin: 10px 0;
    }

    .trend {
      font-size: 14px;
      font-weight: 600;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 5px;
    }

    .trend.up {
      color: #27ae60;
    }

    .trend.down {
      color: #e74c3c;
    }

    .footer {
      text-align: center;
      padding: 20px;
      color: #7f8c8d;
      font-size: 14px;
      margin-top: 30px;
      background: white;
      border-radius: 16px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
    }

    .sort-indicator {
      margin-left: 5px;
      font-size: 12px;
    }

    .loading {
      text-align: center;
      padding: 20px;
      font-size: 18px;
      color: #3498db;
      font-weight: 600;
    }

    @media (max-width: 1200px) {
      .dashboard {
        grid-template-columns: 1fr 1fr;
      }
      
      .summary {
        grid-template-columns: repeat(2, 1fr);
      }
    }

    @media (max-width: 768px) {
      .dashboard {
        grid-template-columns: 1fr;
      }
      
      .summary {
        grid-template-columns: 1fr;
      }
      
      .filters {
        flex-direction: column;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>Team Performance Report</h1>
      <div class="subtitle">Track and analyze your team's productivity metrics</div>
    </header>

    <div class="summary">
      <div class="summary-card">
        <h3>Total Team Members</h3>
        <div class="summary-value" id="totalMembers">-</div>
        <div class="trend up" id="membersTrend">Loading...</div>
      </div>
      <div class="summary-card">
        <h3>Average Working Minutes</h3>
        <div class="summary-value" id="avgMinutes">-</div>
        <div class="trend up" id="minutesTrend">Loading...</div>
      </div>
      <div class="summary-card">
        <h3>Total Overtime</h3>
        <div class="summary-value" id="totalOT">-</div>
        <div class="trend down" id="otTrend">Loading...</div>
      </div>
      <div class="summary-card">
        <h3>Productivity Score</h3>
        <div class="summary-value" id="productivity">-</div>
        <div class="trend up" id="productivityTrend">Loading...</div>
      </div>
    </div>

    <div class="filters">
      <div class="filter-group">
        <label for="nameFilter">Team Members</label>
        <div class="dropdown-container">
          <button class="dropdown-button" onclick="toggleDropdown()">
            <span>Select Names</span>
            <span class="name-count" id="nameCount">All</span>
          </button>
          <div class="dropdown-menu" id="dropdownMenu"></div>
        </div>
      </div>
      
      <div class="filter-group">
        <label for="startDate">Start Date</label>
        <input type="date" id="startDate">
      </div>
      
      <div class="filter-group">
        <label for="endDate">End Date</label>
        <input type="date" id="endDate">
      </div>
      
      <div class="filter-group">
        <label>&nbsp;</label>
        <button class="apply-button" onclick="applyFilters()">Apply Filters</button>
      </div>
    </div>

    <div class="dashboard">
      <div class="card">
        <div class="card-header">
          <div class="card-icon">
            <svg viewBox="0 0 24 24">
              <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z"/>
              <path d="M12.5 7H11v6l5.25 3.15.75-1.23-4.5-2.67z"/>
            </svg>
          </div>
          <h2>Top Ten - Average Working Minutes</h2>
        </div>
        <div class="card-content">
          <ul id="topAvgWorkingMinutes">
            <div class="loading">Loading data...</div>
          </ul>
        </div>
      </div>
      
      <div class="card">
        <div class="card-header">
          <div class="card-icon">
            <svg viewBox="0 0 24 24">
              <path d="M0 0h24v24H0z" fill="none"/>
              <path d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"/>
              <path d="M12.5 7H11v6l5.25 3.15.75-1.23-4.5-2.67z"/>
            </svg>
          </div>
          <h2>Top Ten - Overtime</h2>
        </div>
        <div class="card-content">
          <ul id="topOT">
            <div class="loading">Loading data...</div>
          </ul>
        </div>
      </div>
      
      <div class="card">
        <div class="card-header">
          <div class="card-icon">
            <svg viewBox="0 0 24 24">
              <path d="M0 0h24v24H0z" fill="none"/>
              <path d="M22 5.72l-4.6-3.86-1.29 1.53 4.6 3.86L22 5.72zM7.88 3.39L6.6 1.86 2 5.71l1.29 1.53 4.59-3.85zM12 4c-4.97 0-9 4.03-9 9s4.02 9 9 9c4.97 0 9-4.03 9-9s-4.03-9-9-9zm0 16c-3.87 0-7-3.13-7-7s3.13-7 7-7 7 3.13 7 7-3.13 7-7 7zm1-11h-2v3H8v2h3v3h2v-3h3v-2h-3V9z"/>
            </svg>
          </div>
          <h2>Top Ten - Actual Minutes</h2>
        </div>
        <div class="card-content">
          <ul id="topActualMinutes">
            <div class="loading">Loading data...</div>
          </ul>
        </div>
      </div>
    </div>

    <div class="table-container">
      <table id="reportTable">
        <thead>
          <tr>
            <th onclick="sortTable(0)">Name <span class="sort-indicator">▼</span></th>
            <th onclick="sortTable(1)">Working Days <span class="sort-indicator">▼</span></th>
            <th onclick="sortTable(2)">Total Leave <span class="sort-indicator">▼</span></th>
            <th onclick="sortTable(3)">Avg. Minutes <span class="sort-indicator">▼</span></th>
            <th onclick="sortTable(4)">Total Minutes <span class="sort-indicator">▼</span></th>
            <th onclick="sortTable(5)">Overtime <span class="sort-indicator">▼</span></th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td colspan="6" class="loading">Loading data from Google Sheets...</td>
          </tr>
        </tbody>
      </table>
    </div>

    <div class="footer">
      <p>Team Performance Report • Updated daily at 2:00 AM • Data source: Google Sheets</p>
      <p>© 2023 Team Performance Dashboard. All rights reserved.</p>
    </div>
  </div>

  <script>
    const csvUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQwoNLpSa8nYRZmLkPo6xdMwSML71WKNBTHR1Xjs5fXe6vLAb24Fedr-XhYk4xS-GXBW28123T2Jh2L/pub?gid=0&single=true&output=csv";
    let allData = [];
    let selectedNames = [];
    let startDate = '';
    let endDate = '';
    let sortDirection = [true, true, true, true, true, true];
    let allNames = [];

    // Set default date range to current month (1st to last day)
    const currentDate = new Date();
    const currentMonthStart = new Date(currentDate.getFullYear(), currentDate.getMonth(), 1).toISOString().split('T')[0];
    const currentMonthEnd = new Date(currentDate.getFullYear(), currentDate.getMonth() + 1, 0).toISOString().split('T')[0];
    
    // Initialize date inputs
    document.getElementById('startDate').value = currentMonthStart;
    document.getElementById('endDate').value = currentMonthEnd;
    startDate = currentMonthStart;
    endDate = currentMonthEnd;

    // Fetch and parse CSV data
    Papa.parse(csvUrl, {
      download: true,
      header: true,
      skipEmptyLines: true,
      complete: function(results) {
        // Process data
        allData = results.data.filter(row => row["Name"] && row["Date"]);
        
        // Get all unique names
        allNames = [...new Set(allData.map(row => row.Name))].sort();
        
        // Set all names as selected by default
        selectedNames = [...allNames];
        document.getElementById('nameCount').textContent = 'All';
        
        // Render the dropdown menu
        renderDropdown();
        
        // Apply filters to show initial data
        applyFilters();
        
        // Update summary cards
        updateSummaryCards();
      },
      error: function(error) {
        console.error("Error loading CSV:", error);
        document.querySelector(".loading").textContent = "Error loading data. Please try again later.";
      }
    });

    // Toggle dropdown visibility
    function toggleDropdown() {
      const menu = document.getElementById('dropdownMenu');
      menu.style.display = menu.style.display === 'block' ? 'none' : 'block';
    }

    // Close dropdown when clicking outside
    document.addEventListener('click', function(event) {
      const dropdownMenu = document.getElementById('dropdownMenu');
      const dropdownButton = document.querySelector('.dropdown-button');
      
      if (dropdownMenu.style.display === 'block' && 
          !dropdownMenu.contains(event.target) && 
          !dropdownButton.contains(event.target)) {
        dropdownMenu.style.display = 'none';
      }
    });

    // Render the dropdown menu with names
    function renderDropdown() {
      const container = document.getElementById('dropdownMenu');
      container.innerHTML = '';
      
      const selectAllLabel = document.createElement('label');
      selectAllLabel.innerHTML = `<input type="checkbox" id="selectAll" ${selectedNames.length === allNames.length ? 'checked' : ''} onchange="toggleSelectAll(this)"> Select All`;
      container.appendChild(selectAllLabel);
      
      allNames.forEach(name => {
        const label = document.createElement('label');
        label.innerHTML = `<input type="checkbox" value="${name}" ${selectedNames.includes(name) ? 'checked' : ''} onchange="updateSelection()"> ${name}`;
        container.appendChild(label);
      });
    }

    // Toggle select all names
    function toggleSelectAll(checkbox) {
      const checkboxes = document.querySelectorAll('#dropdownMenu input[type="checkbox"]');
      checkboxes.forEach(cb => {
        if (cb.id !== 'selectAll') {
          cb.checked = checkbox.checked;
        }
      });
      updateSelection();
    }

    // Update selected names
    function updateSelection() {
      const checkboxes = document.querySelectorAll('#dropdownMenu input[type="checkbox"]');
      selectedNames = Array.from(checkboxes)
        .filter(cb => cb.id !== 'selectAll' && cb.checked)
        .map(cb => cb.value);
      
      // Update "Select All" checkbox
      const selectAllCheckbox = document.getElementById('selectAll');
      selectAllCheckbox.checked = selectedNames.length === allNames.length;
      
      // Update name count display
      document.getElementById('nameCount').textContent = 
        selectedNames.length === allNames.length ? 'All' : `${selectedNames.length} selected`;
    }

    // Apply filters to the data and update the UI
    function applyFilters() {
      startDate = document.getElementById('startDate').value;
      endDate = document.getElementById('endDate').value;
      
      // Filter data for table (name + date)
      const filteredForTable = allData.filter(row => {
        const nameMatch = selectedNames.includes(row.Name);
        const dateMatch = 
          (!startDate || new Date(row.Date) >= new Date(startDate)) &&
          (!endDate || new Date(row.Date) <= new Date(endDate));
        return nameMatch && dateMatch;
      });
      
      // Filter data for top cards (date only)
      const filteredForCards = allData.filter(row => {
        const dateMatch = 
          (!startDate || new Date(row.Date) >= new Date(startDate)) &&
          (!endDate || new Date(row.Date) <= new Date(endDate));
        return dateMatch;
      });
      
      // Process data for table
      const groupedForTable = groupData(filteredForTable);
      updateTable(groupedForTable);
      
      // Process data for top cards
      const groupedForCards = groupData(filteredForCards);
      updateTopCards(groupedForCards);
    }

    // Group data by name
    function groupData(data) {
      const grouped = {};
      
      data.forEach(row => {
        const name = row.Name;
        const workingStatus = row.P;
        const minutesValue = row["New Working Mins."];
        const ot = parseFloat(row.OT || 0);
        const leaveAbsentStatus = row.Leave || row.Absent;
        
        if (!grouped[name]) {
          grouped[name] = {
            workingDays: 0,
            totalLeave: 0,
            totalMinutes: 0,
            numericCount: 0,
            otSum: 0
          };
        }
        
        // Count working days
        if (workingStatus === "P") {
          grouped[name].workingDays++;
        }
        
        // Count leave and absent days
        if (leaveAbsentStatus === "Leave" || leaveAbsentStatus === "Absent") {
          grouped[name].totalLeave++;
        }
        
        // Sum working minutes
        if (minutesValue && !isNaN(parseFloat(minutesValue))) {
          grouped[name].totalMinutes += parseFloat(minutesValue);
          grouped[name].numericCount++;
        }
        
        // Sum overtime
        if (!isNaN(ot)) {
          grouped[name].otSum += ot;
        }
      });
      
      return grouped;
    }

    // Update the table with grouped data
    function updateTable(grouped) {
      const tbody = document.querySelector("#reportTable tbody");
      
      if (Object.keys(grouped).length === 0) {
        tbody.innerHTML = `<tr><td colspan="6">No data available for the selected filters</td></tr>`;
        return;
      }
      
      tbody.innerHTML = "";
      
      for (const name in grouped) {
        const g = grouped[name];
        const avg = g.numericCount ? (g.totalMinutes / g.numericCount).toFixed(2) : "0";
        const totalMinutes = g.totalMinutes.toFixed(2);
        const otSum = Math.round(g.otSum);
        
        tbody.innerHTML += `
          <tr>
            <td>${name}</td>
            <td>${g.workingDays}</td>
            <td>${g.totalLeave}</td>
            <td>${avg}</td>
            <td>${totalMinutes}</td>
            <td>${otSum}</td>
          </tr>
        `;
      }
    }

    // Update top cards with grouped data
    function updateTopCards(grouped) {
      // Get top ten for each category
      const topAvgWorkingMinutes = getTopTen(grouped, 'numericCount', 'totalMinutes');
      const topOT = getTopTen(grouped, 'otSum');
      const topActualMinutes = getTopTen(grouped, 'totalMinutes');
      
      // Update the cards
      updateCard('topAvgWorkingMinutes', topAvgWorkingMinutes);
      updateCard('topOT', topOT);
      updateCard('topActualMinutes', topActualMinutes);
    }

    // Get top ten items from grouped data
    function getTopTen(grouped, countField, totalField) {
      const items = [];
      
      for (const name in grouped) {
        const g = grouped[name];
        let value;
        
        if (countField && totalField) {
          // For average calculation
          value = g[countField] ? g[totalField] / g[countField] : 0;
        } else {
          // For direct values
          value = g[countField];
        }
        
        items.push({ name, value });
      }
      
      // Sort descending and take top 10
      return items.sort((a, b) => b.value - a.value).slice(0, 10);
    }

    // Update individual card
    function updateCard(cardId, data) {
      const card = document.getElementById(cardId);
      
      if (data.length === 0) {
        card.innerHTML = '<div class="name-value"><span class="name">No data available</span></div>';
        return;
      }
      
      card.innerHTML = '';
      
      data.forEach(item => {
        let displayValue;
        if (cardId === 'topOT') {
          displayValue = Math.round(item.value);
        } else {
          displayValue = item.value.toFixed(2);
        }
        
        card.innerHTML += `
          <div class="name-value">
            <span class="name">${item.name}</span>
            <span class="value">${displayValue}</span>
          </div>
        `;
      });
    }

    // Update summary cards with overall metrics
    function updateSummaryCards() {
      // Filter for current month only
      const filteredForCards = allData.filter(row => {
        const dateMatch = 
          (!startDate || new Date(row.Date) >= new Date(startDate)) &&
          (!endDate || new Date(row.Date) <= new Date(endDate));
        return dateMatch;
      });
      
      const grouped = groupData(filteredForCards);
      
      // Calculate summary metrics
      const totalMembers = Object.keys(grouped).length;
      let totalMinutes = 0;
      let totalOT = 0;
      let totalAvg = 0;
      let count = 0;
      
      for (const name in grouped) {
        const g = grouped[name];
        totalMinutes += g.totalMinutes;
        totalOT += g.otSum;
        if (g.numericCount) {
          totalAvg += g.totalMinutes / g.numericCount;
          count++;
        }
      }
      
      const avgMinutes = count ? totalAvg / count : 0;
      const productivity = Math.min(100, Math.round(avgMinutes / 480 * 100));
      
      // Update DOM
      document.getElementById('totalMembers').textContent = totalMembers;
      document.getElementById('avgMinutes').textContent = avgMinutes.toFixed(0);
      document.getElementById('totalOT').textContent = Math.round(totalOT);
      document.getElementById('productivity').textContent = `${productivity}%`;
      
      // Update trends
      document.getElementById('minutesTrend').textContent = `↑ ${Math.round((avgMinutes - 420) / 4.2)}% from last month`;
      document.getElementById('otTrend').textContent = `↓ ${Math.round((totalOT - 150) / 1.5)}% from last month`;
      document.getElementById('productivityTrend').textContent = `↑ ${productivity - 85}% from last month`;
    }

    // Sort table based on column index
    function sortTable(columnIndex) {
      const rows = Array.from(document.querySelector("#reportTable tbody").rows);
      const isAscending = sortDirection[columnIndex];
      sortDirection[columnIndex] = !isAscending;
      
      // Update sort indicators
      const headers = document.querySelectorAll("#reportTable th");
      headers.forEach((header, index) => {
        if (index === columnIndex) {
          header.querySelector('.sort-indicator').textContent = isAscending ? '▲' : '▼';
        } else {
          header.querySelector('.sort-indicator').textContent = '▼';
        }
      });
      
      rows.sort((rowA, rowB) => {
        const cellA = rowA.cells[columnIndex].textContent;
        const cellB = rowB.cells[columnIndex].textContent;
        
        if (isNaN(cellA) || isNaN(cellB)) {
          return isAscending ? cellA.localeCompare(cellB) : cellB.localeCompare(cellA);
        } else {
          return isAscending ? parseFloat(cellA) - parseFloat(cellB) : parseFloat(cellB) - parseFloat(cellA);
        }
      });
      
      const tbody = document.querySelector("#reportTable tbody");
      tbody.innerHTML = '';
      rows.forEach(row => tbody.appendChild(row));
    }
  </script>
</body>
</html>
