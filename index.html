<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>360 Issue Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="icon" href="https://spyne-prod-ai.s3.us-east-1.amazonaws.com/ai-dataset/2025/favicon.ico" type="image/x-icon" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/tom-select@2.2.2/dist/css/tom-select.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/tom-select@2.2.2/dist/js/tom-select.complete.min.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/litepicker/dist/css/litepicker.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/litepicker/dist/litepicker.js"></script>
  <style>
  /* Global styles */
  body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f8f9fa; margin: 0; padding: 20px; color: #333; }
  .header-bar { position: fixed; top: 0; left: 0; right: 0; background: #fff; padding: 15px 0; text-align: center; font-weight: bold; font-size: 22px; z-index: 10000; box-shadow: 0 2px 8px rgba(0,0,0,0.1); background: linear-gradient(135deg, #0057a3, #003d73); color: white; }
  .tabs { position: fixed; top: 64px; left: 0; right: 0; background: #fff; display: flex; border-bottom: 1px solid #e1e4e8; z-index: 10000; }
  .tab { padding: 12px 20px; cursor: pointer; font-weight: 600; color: #555; border-bottom: 3px solid transparent; user-select: none; transition: all 0.2s; }
  .tab:hover { background: #f1f8ff; }
  .tab.active { color: #007bff; border-color: #007bff; background: #f1f8ff; }
  .tab-content { display: none; }
  .tab-content.active { display: block; }
  .main-content { margin-top: 220px; padding: 0 20px; }
  .filters { position: fixed; top: 108px; left: 0; right: 0; background: #f8f9fa; padding: 12px 20px; display: flex; flex-wrap: wrap; gap: 10px; justify-content: center; border-bottom: 1px solid #e1e4e8; z-index: 9999; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
  .filters select, .filters button, .filters input { padding: 8px 12px; font-size: 14px; border-radius: 4px; border: 1px solid #ced4da; cursor: pointer; background: white; }
  .filters select:focus, .filters input:focus { outline: none; border-color: #007bff; box-shadow: 0 0 0 2px rgba(0,123,255,0.25); }
  .summary-bar { position: fixed; top: 160px; left: 0; right: 0; background: #e2e6ea; z-index: 9998; padding: 10px 20px; display: flex; justify-content: space-between; font-weight: bold; border-top: 1px solid #d1d8e0; border-bottom: 1px solid #d1d8e0; }
  .summary-section { position: fixed; top: 200px; left: 0; right: 0; background: #fff; z-index: 9997; padding: 12px 20px; display: flex; gap: 20px; justify-content: center; border-bottom: 1px solid #e1e4e8; font-weight: 600; user-select: none; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
  .summary-item { flex: 1; text-align: center; font-size: 16px; color: #333; }
  .summary-value { font-size: 22px; color: #007bff; display: block; margin-top: 4px; font-weight: 700; }
  .chart-row { display: flex; gap: 20px; justify-content: space-between; margin: 20px 0; flex-wrap: wrap; }
  .chart-box.issue { flex: 2; background: #fff; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.08); }
  .chart-box.pie { flex: 1; background: #fff; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.08); }
  .dual-table-row { display: flex; gap: 20px; margin-bottom: 20px; flex-wrap: wrap; }
  .full-width-table { flex: 1; max-height: 400px; overflow-y: auto; background: #fff; padding: 10px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.08); }
  .bottom-row { display: flex; gap: 20px; flex-wrap: wrap; }
  .table-box { flex: 1; max-height: 320px; overflow-y: auto; background: #fff; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.08); }
  .iframe-box { flex: 2; background: #fff; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.08); overflow: hidden; }
  table { width: 100%; border-collapse: collapse; margin-top: 10px; }
  th, td { border: 1px solid #dee2e6; padding: 10px 15px; text-align: center; }
  th { background-color: #0057a3; color: white; position: sticky; top: 0; z-index: 1; font-weight: 600; }
  tr:nth-child(even) { background-color: #f8f9fa; }
  tr:hover { background-color: #e9f7ff; }
  .summary-tables { margin-top: 30px; background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.08); }
  .chart-container { background: #fff; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.08); flex: 1; min-width: 300px; }
  canvas { width: 100% !important; height: auto !important; }
  
  /* Summary Tab Styles */
  .sub-tabs { display: flex; background: #f1f5f9; border-radius: 8px; padding: 5px; margin-bottom: 20px; }
  .sub-tab { flex: 1; text-align: center; padding: 10px; cursor: pointer; border-radius: 6px; transition: all 0.3s; font-weight: 600; }
  .sub-tab:hover { background: #e2e8f0; }
  .sub-tab.active { background: #007bff; color: white; }
  .sub-tab-content { display: none; }
  .sub-tab-content.active { display: block; }
  .summary-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
  .summary-header h3 { margin: 0; color: #0057a3; }
  .date-range-display { background: #e3f2fd; padding: 5px 10px; border-radius: 4px; font-size: 14px; }
  .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px; }
  .stat-card { background: white; border-radius: 8px; padding: 15px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); text-align: center; border-left: 4px solid #007bff; }
  .stat-card h4 { margin: 0 0 10px 0; font-size: 14px; color: #6c757d; }
  .stat-card .value { font-size: 24px; font-weight: 700; color: #0057a3; }
  .stat-card .change { font-size: 12px; color: #28a745; margin-top: 5px; }
  .stat-card .change.negative { color: #dc3545; }
  
  /* Responsive adjustments */
  @media (max-width: 768px) {
    .chart-row, .dual-table-row, .bottom-row { flex-direction: column; }
    .chart-box.issue, .chart-box.pie { width: 100%; }
    .filters { flex-direction: column; align-items: center; }
    .main-content { margin-top: 280px; }
  }
</style>
</head>
<body>
  <div class="header-bar">360 Issue Dashboard</div>
  <div class="filters" id="dashboardFilters">
    <select id="enterpriseFilter">
      <option value="">All Enterprises</option>
      <option>Enterprise A</option>
      <option>Enterprise B</option>
      <option>Enterprise C</option>
    </select>
    <select id="severityFilter">
      <option value="">All Severities</option>
      <option>Blocker</option>
      <option>High</option>
      <option>Low</option>
    </select>
    <select id="issueFilter">
      <option value="">All Issues</option>
      <option>Image Quality</option>
      <option>Rotation</option>
      <option>Color Issue</option>
      <option>Background</option>
    </select>
    <button onclick="applyFilters()">Apply Filters</button>
  </div>
  <div class="tabs">
    <div class="tab active" data-tab="dashboardTab">Dashboard</div>
    <div class="tab" data-tab="summaryTab">Summary</div>
    <div class="tab" data-tab="qcReportTab">QC Report</div>
  </div>
  
  <!-- Dashboard Tab -->
  <div class="main-content tab-content active" id="dashboardTab">
    <div class="summary-section">
      <div class="summary-item">Total Issues <span class="summary-value">128</span></div>
      <div class="summary-item">Blocker <span class="summary-value">24</span></div>
      <div class="summary-item">High <span class="summary-value">56</span></div>
      <div class="summary-item">Low <span class="summary-value">48</span></div>
    </div>
    <div class="chart-row">
      <div class="chart-box issue"><canvas id="issueChart"></canvas></div>
      <div class="chart-box pie"><canvas id="severityPie"></canvas></div>
    </div>
    <div class="dual-table-row">
      <div class="full-width-table">
        <h3>Issue Summary</h3>
        <table id="issueSummary">
          <thead>
            <tr>
              <th>Issue</th><th>Total (%)</th><th>Blocker (%)</th><th>High (%)</th><th>Low (%)</th>
            </tr>
          </thead>
          <tbody>
            <tr><td>Image Quality</td><td><b>28.1%</b> <span>(36)</span></td><td><b>16.7%</b> <span>(6)</span></td><td><b>39.3%</b> <span>(22)</span></td><td><b>16.7%</b> <span>(8)</span></td></tr>
            <tr><td>Rotation</td><td><b>21.9%</b> <span>(28)</span></td><td><b>25.0%</b> <span>(6)</span></td><td><b>25.0%</b> <span>(14)</span></td><td><b>16.7%</b> <span>(8)</span></td></tr>
            <tr><td>Color Issue</td><td><b>18.8%</b> <span>(24)</span></td><td><b>25.0%</b> <span>(6)</span></td><td><b>17.9%</b> <span>(10)</span></td><td><b>16.7%</b> <span>(8)</span></td></tr>
            <tr><td>Background</td><td><b>15.6%</b> <span>(20)</span></td><td><b>16.7%</b> <span>(4)</span></td><td><b>17.9%</b> <span>(10)</span></td><td><b>12.5%</b> <span>(6)</span></td></tr>
            <tr><td>Other</td><td><b>15.6%</b> <span>(20)</span></td><td><b>16.7%</b> <span>(2)</span></td><td><b>0.0%</b> <span>(0)</span></td><td><b>37.5%</b> <span>(18)</span></td></tr>
          </tbody>
        </table>
      </div>
      <div class="full-width-table">
        <h3>Enterprise Summary</h3>
        <table id="enterpriseSummary">
          <thead>
            <tr>
              <th>Enterprise</th><th>Total (%)</th><th>Blocker (%)</th><th>High (%)</th><th>Low (%)</th>
            </tr>
          </thead>
          <tbody>
            <tr><td>Enterprise A</td><td><b>32.8%</b> <span>(42)</span></td><td><b>37.5%</b> <span>(9)</span></td><td><b>32.1%</b> <span>(18)</span></td><td><b>31.2%</b> <span>(15)</span></td></tr>
            <tr><td>Enterprise B</td><td><b>28.1%</b> <span>(36)</span></td><td><b>25.0%</b> <span>(6)</span></td><td><b>28.6%</b> <span>(16)</span></td><td><b>29.2%</b> <span>(14)</span></td></tr>
            <tr><td>Enterprise C</td><td><b>23.4%</b> <span>(30)</span></td><td><b>25.0%</b> <span>(6)</span></td><td><b>25.0%</b> <span>(14)</span></td><td><b>20.8%</b> <span>(10)</span></td></tr>
            <tr><td>Enterprise D</td><td><b>15.6%</b> <span>(20)</span></td><td><b>12.5%</b> <span>(3)</span></td><td><b>14.3%</b> <span>(8)</span></td><td><b>18.8%</b> <span>(9)</span></td></tr>
          </tbody>
        </table>
      </div>
    </div>
    <div class="bottom-row">
      <div class="table-box">
        <h3>Recent Issues</h3>
        <table id="spinTable">
          <thead>
            <tr>
              <th>Spin ID</th><th>Issue</th><th>Severity</th><th>Enterprise</th>
            </tr>
          </thead>
          <tbody>
            <tr><td>SP-1024</td><td>Image Quality</td><td>Blocker</td><td>Enterprise A</td></tr>
            <tr><td>SP-1025</td><td>Rotation</td><td>High</td><td>Enterprise B</td></tr>
            <tr><td>SP-1026</td><td>Color Issue</td><td>High</td><td>Enterprise C</td></tr>
            <tr><td>SP-1027</td><td>Background</td><td>Low</td><td>Enterprise D</td></tr>
            <tr><td>SP-1028</td><td>Image Quality</td><td>High</td><td>Enterprise A</td></tr>
            <tr><td>SP-1029</td><td>Rotation</td><td>Blocker</td><td>Enterprise B</td></tr>
          </tbody>
        </table>
      </div>
      <div class="iframe-box">
        <iframe id="spinIframe" title="Spin Preview" src="https://example.com/spin-preview" style="height:100%;width:100%;border:none;"></iframe>
      </div>
    </div>
  </div>
  
  <!-- Summary Tab -->
  <div class="main-content tab-content" id="summaryTab">
    <div class="sub-tabs">
      <div class="sub-tab active" data-subtab="monthlyTab">Current Month</div>
      <div class="sub-tab" data-subtab="weeklyTab">Week Wise</div>
    </div>
    
    <!-- Monthly View -->
    <div class="sub-tab-content active" id="monthlyTab">
      <div class="summary-header">
        <h3>July 2025 Summary</h3>
        <div class="date-range-display">July 1 - July 31, 2025</div>
      </div>
      
      <div class="stats-grid">
        <div class="stat-card">
          <h4>Total Issues</h4>
          <div class="value">128</div>
          <div class="change">↓ 12% from last month</div>
        </div>
        <div class="stat-card">
          <h4>Blocker Issues</h4>
          <div class="value">24</div>
          <div class="change">↓ 8% from last month</div>
        </div>
        <div class="stat-card">
          <h4>High Severity</h4>
          <div class="value">56</div>
          <div class="change">↓ 15% from last month</div>
        </div>
        <div class="stat-card">
          <h4>Low Severity</h4>
          <div class="value">48</div>
          <div class="change">↑ 9% from last month</div>
        </div>
      </div>
      
      <div class="chart-row">
        <div class="chart-container">
          <h3>Severity Trend (%)</h3>
          <canvas id="severityTrendChart"></canvas>
        </div>
        <div class="chart-container">
          <h3>Issue Trend (%)</h3>
          <canvas id="issueTrendChart"></canvas>
        </div>
      </div>
      
      <div class="summary-tables">
        <h3>Severity Details (Month-wise)</h3>
        <table id="severityDetailsTable">
          <thead>
            <tr>
              <th>Severity</th>
              <th>Jul 2025</th>
              <th>Jun 2025</th>
              <th>May 2025</th>
              <th>Apr 2025</th>
            </tr>
          </thead>
          <tbody>
            <tr><td>Blocker</td><td>24 (18.8%)</td><td>26 (19.7%)</td><td>30 (22.1%)</td><td>28 (20.3%)</td></tr>
            <tr><td>High</td><td>56 (43.8%)</td><td>66 (50.0%)</td><td>62 (45.6%)</td><td>60 (43.5%)</td></tr>
            <tr><td>Low</td><td>48 (37.5%)</td><td>40 (30.3%)</td><td>44 (32.4%)</td><td>50 (36.2%)</td></tr>
          </tbody>
        </table>
        
        <h3 style="margin-top: 30px;">Issue Details (Month-wise)</h3>
        <table id="issueDetailsTable">
          <thead>
            <tr>
              <th>Issue</th>
              <th>Jul 2025</th>
              <th>Jun 2025</th>
              <th>May 2025</th>
              <th>Apr 2025</th>
            </tr>
          </thead>
          <tbody>
            <tr><td>Image Quality</td><td>36 (28.1%)</td><td>38 (28.8%)</td><td>42 (30.9%)</td><td>40 (29.0%)</td></tr>
            <tr><td>Rotation</td><td>28 (21.9%)</td><td>32 (24.2%)</td><td>30 (22.1%)</td><td>34 (24.6%)</td></tr>
            <tr><td>Color Issue</td><td>24 (18.8%)</td><td>22 (16.7%)</td><td>20 (14.7%)</td><td>18 (13.0%)</td></tr>
            <tr><td>Background</td><td>20 (15.6%)</td><td>18 (13.6%)</td><td>22 (16.2%)</td><td>24 (17.4%)</td></tr>
            <tr><td>Other</td><td>20 (15.6%)</td><td>22 (16.7%)</td><td>22 (16.2%)</td><td>22 (15.9%)</td></tr>
          </tbody>
        </table>
      </div>
    </div>
    
    <!-- Weekly View -->
    <div class="sub-tab-content" id="weeklyTab">
      <div class="summary-header">
        <h3>Last Four Weeks Summary</h3>
        <div class="date-range-display">Jun 30 - Jul 27, 2025</div>
      </div>
      
      <div class="stats-grid">
        <div class="stat-card">
          <h4>Total Issues</h4>
          <div class="value">94</div>
          <div class="change">↓ 7% from previous period</div>
        </div>
        <div class="stat-card">
          <h4>Blocker Issues</h4>
          <div class="value">18</div>
          <div class="change">↓ 10% from previous period</div>
        </div>
        <div class="stat-card">
          <h4>High Severity</h4>
          <div class="value">40</div>
          <div class="change">↓ 13% from previous period</div>
        </div>
        <div class="stat-card">
          <h4>Low Severity</h4>
          <div class="value">36</div>
          <div class="change">↑ 9% from previous period</div>
        </div>
      </div>
      
      <div class="chart-row">
        <div class="chart-container">
          <h3>Severity Trend by Week (%)</h3>
          <canvas id="weeklySeverityChart"></canvas>
        </div>
        <div class="chart-container">
          <h3>Issue Distribution by Week</h3>
          <canvas id="weeklyIssueChart"></canvas>
        </div>
      </div>
      
      <div class="summary-tables">
        <h3>Severity Details (Week-wise)</h3>
        <table id="weeklySeverityTable">
          <thead>
            <tr>
              <th>Severity</th>
              <th>Week 1 (Jun 30 - Jul 6)</th>
              <th>Week 2 (Jul 7 - 13)</th>
              <th>Week 3 (Jul 14 - 20)</th>
              <th>Week 4 (Jul 21 - 27)</th>
            </tr>
          </thead>
          <tbody>
            <tr><td>Blocker</td><td>6 (20.0%)</td><td>4 (13.3%)</td><td>5 (16.7%)</td><td>3 (10.7%)</td></tr>
            <tr><td>High</td><td>12 (40.0%)</td><td>14 (46.7%)</td><td>10 (33.3%)</td><td>4 (14.3%)</td></tr>
            <tr><td>Low</td><td>12 (40.0%)</td><td>12 (40.0%)</td><td>15 (50.0%)</td><td>21 (75.0%)</td></tr>
            <tr style="font-weight:bold;"><td>Total</td><td>30</td><td>30</td><td>30</td><td>28</td></tr>
          </tbody>
        </table>
        
        <h3 style="margin-top: 30px;">Issue Details (Week-wise)</h3>
        <table id="weeklyIssueTable">
          <thead>
            <tr>
              <th>Issue</th>
              <th>Week 1 (Jun 30 - Jul 6)</th>
              <th>Week 2 (Jul 7 - 13)</th>
              <th>Week 3 (Jul 14 - 20)</th>
              <th>Week 4 (Jul 21 - 27)</th>
            </tr>
          </thead>
          <tbody>
            <tr><td>Image Quality</td><td>8 (26.7%)</td><td>9 (30.0%)</td><td>10 (33.3%)</td><td>9 (32.1%)</td></tr>
            <tr><td>Rotation</td><td>7 (23.3%)</td><td>6 (20.0%)</td><td>8 (26.7%)</td><td>7 (25.0%)</td></tr>
            <tr><td>Color Issue</td><td>6 (20.0%)</td><td>5 (16.7%)</td><td>4 (13.3%)</td><td>3 (10.7%)</td></tr>
            <tr><td>Background</td><td>5 (16.7%)</td><td>5 (16.7%)</td><td>4 (13.3%)</td><td>6 (21.4%)</td></tr>
            <tr><td>Other</td><td>4 (13.3%)</td><td>5 (16.7%)</td><td>4 (13.3%)</td><td>3 (10.7%)</td></tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
  
  <!-- QC Report Tab -->
  <div class="main-content tab-content" id="qcReportTab">
    <div class="sticky-header">
      <h1>QC Report Dashboard</h1>
      <div class="filters">
        <input type="text" id="dateRange" placeholder="Select Date Range..." readonly>
        <select id="enterpriseFilter" multiple placeholder="Select Enterprise..."></select>
        <select id="severityFilter">
          <option value="">All Severities</option>
          <option>Blocker</option>
          <option>High</option>
          <option>Low</option>
        </select>
        <select id="issueFilter" multiple placeholder="Select Issue..."></select>
        <select id="userFilter" multiple placeholder="Select User..."></select>
      </div>
    </div>
    <h2>Date-wise Summary</h2>
    <div class="table-wrapper">
      <table id="summaryTable">
        <thead>
          <tr>
            <th>Date</th><th>SKU Count</th><th>Unique Enterprises</th><th>Total Edited Images</th><th>Average TAT</th>
          </tr>
        </thead>
        <tbody>
          <tr><td>2025-07-28</td><td>24</td><td>4</td><td>56</td><td>12.4</td></tr>
          <tr><td>2025-07-27</td><td>32</td><td>6</td><td>68</td><td>14.2</td></tr>
          <tr><td>2025-07-26</td><td>28</td><td>5</td><td>62</td><td>11.8</td></tr>
        </tbody>
      </table>
    </div>
    <h2>Detailed Report</h2>
    <div class="table-wrapper">
      <table id="reportTable">
        <thead>
          <tr>
            <th>Date</th><th>Spin ID</th><th>SKU ID</th><th>Enterprise Name</th><th>User</th><th>Edited</th><th>TAT (Min)</th><th>View Spin</th>
          </tr>
        </thead>
        <tbody>
          <tr><td>2025-07-28</td><td>SP-1030</td><td>SKU-789</td><td>Enterprise B</td><td>John D</td><td>12</td><td>14.2</td><td><a href="#" onclick="openSpinDialog()">View</a></td></tr>
          <tr><td>2025-07-28</td><td>SP-1029</td><td>SKU-456</td><td>Enterprise A</td><td>Sarah M</td><td>8</td><td>10.5</td><td><a href="#" onclick="openSpinDialog()">View</a></td></tr>
          <tr><td>2025-07-27</td><td>SP-1028</td><td>SKU-123</td><td>Enterprise C</td><td>Mike T</td><td>10</td><td>12.8</td><td><a href="#" onclick="openSpinDialog()">View</a></td></tr>
        </tbody>
      </table>
    </div>
    <div id="spinModal" style="display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.6);z-index:1000;justify-content:center;align-items:center;flex-direction:column;">
      <div style="background:#fff;padding:20px;width:80vw;height:80vh;overflow:auto;border-radius:8px;position:relative;display:flex;flex-direction:column;">
        <span onclick="document.getElementById('spinModal').style.display='none'" style="position:absolute;top:10px;right:15px;font-size:20px;cursor:pointer;">&times;</span>
        <div id="modalInfo" style="margin-bottom:10px;font-weight:bold;text-align:center;">SP-1030 | Enterprise B | John D</div>
        <div style="margin-bottom:10px;text-align:right;">
          <button onclick="navigateSpin(-1)">Previous</button>
          <button onclick="navigateSpin(1)">Next</button>
        </div>
        <iframe id="modalIframe" src="https://example.com/spin-preview" style="width:100%;height:500px;border:none;display:block;margin:auto;"></iframe>
      </div>
    </div>
  </div>

  <script>
    // Tab switching functionality
    document.querySelectorAll('.tab').forEach(tab => {
      tab.addEventListener('click', () => {
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
        tab.classList.add('active');
        document.getElementById(tab.dataset.tab).classList.add('active');
      });
    });
    
    // Sub-tab switching functionality for Summary tab
    document.querySelectorAll('.sub-tab').forEach(tab => {
      tab.addEventListener('click', () => {
        document.querySelectorAll('.sub-tab').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.sub-tab-content').forEach(c => c.classList.remove('active'));
        tab.classList.add('active');
        document.getElementById(tab.dataset.subtab).classList.add('active');
      });
    });
    
    // Initialize charts
    document.addEventListener('DOMContentLoaded', () => {
      // Severity Trend Chart (Monthly)
      new Chart(document.getElementById('severityTrendChart'), {
        type: 'line',
        data: {
          labels: ['Apr', 'May', 'Jun', 'Jul'],
          datasets: [
            {
              label: 'Blocker',
              data: [20.3, 22.1, 19.7, 18.8],
              borderColor: '#FF6384',
              backgroundColor: 'rgba(255, 99, 132, 0.1)',
              tension: 0.3,
              fill: true
            },
            {
              label: 'High',
              data: [43.5, 45.6, 50.0, 43.8],
              borderColor: '#36A2EB',
              backgroundColor: 'rgba(54, 162, 235, 0.1)',
              tension: 0.3,
              fill: true
            },
            {
              label: 'Low',
              data: [36.2, 32.4, 30.3, 37.5],
              borderColor: '#4BC0C0',
              backgroundColor: 'rgba(75, 192, 192, 0.1)',
              tension: 0.3,
              fill: true
            }
          ]
        },
        options: {
          responsive: true,
          plugins: {
            legend: { position: 'top' },
            title: { display: true, text: 'Severity Trend Over Time' }
          },
          scales: {
            y: {
              beginAtZero: true,
              title: { display: true, text: 'Percentage' }
            }
          }
        }
      });
      
      // Issue Trend Chart (Monthly)
      new Chart(document.getElementById('issueTrendChart'), {
        type: 'bar',
        data: {
          labels: ['Apr', 'May', 'Jun', 'Jul'],
          datasets: [
            {
              label: 'Image Quality',
              data: [29.0, 30.9, 28.8, 28.1],
              backgroundColor: '#FF9F40'
            },
            {
              label: 'Rotation',
              data: [24.6, 22.1, 24.2, 21.9],
              backgroundColor: '#9966FF'
            },
            {
              label: 'Color Issue',
              data: [13.0, 14.7, 16.7, 18.8],
              backgroundColor: '#FFCD56'
            },
            {
              label: 'Background',
              data: [17.4, 16.2, 13.6, 15.6],
              backgroundColor: '#4BC0C0'
            },
            {
              label: 'Other',
              data: [15.9, 16.2, 16.7, 15.6],
              backgroundColor: '#36A2EB'
            }
          ]
        },
        options: {
          responsive: true,
          plugins: {
            legend: { position: 'top' },
            title: { display: true, text: 'Issue Distribution Over Time' }
          },
          scales: {
            x: { stacked: false },
            y: {
              beginAtZero: true,
              title: { display: true, text: 'Percentage' }
            }
          }
        }
      });
      
      // Weekly Severity Chart
      new Chart(document.getElementById('weeklySeverityChart'), {
        type: 'line',
        data: {
          labels: ['Week 1', 'Week 2', 'Week 3', 'Week 4'],
          datasets: [
            {
              label: 'Blocker',
              data: [20.0, 13.3, 16.7, 10.7],
              borderColor: '#FF6384',
              backgroundColor: 'rgba(255, 99, 132, 0.1)',
              tension: 0.3,
              fill: true
            },
            {
              label: 'High',
              data: [40.0, 46.7, 33.3, 14.3],
              borderColor: '#36A2EB',
              backgroundColor: 'rgba(54, 162, 235, 0.1)',
              tension: 0.3,
              fill: true
            },
            {
              label: 'Low',
              data: [40.0, 40.0, 50.0, 75.0],
              borderColor: '#4BC0C0',
              backgroundColor: 'rgba(75, 192, 192, 0.1)',
              tension: 0.3,
              fill: true
            }
          ]
        },
        options: {
          responsive: true,
          plugins: {
            legend: { position: 'top' },
            title: { display: true, text: 'Weekly Severity Trend' }
          },
          scales: {
            y: {
              beginAtZero: true,
              title: { display: true, text: 'Percentage' }
            }
          }
        }
      });
      
      // Weekly Issue Chart
      new Chart(document.getElementById('weeklyIssueChart'), {
        type: 'bar',
        data: {
          labels: ['Week 1', 'Week 2', 'Week 3', 'Week 4'],
          datasets: [
            {
              label: 'Image Quality',
              data: [26.7, 30.0, 33.3, 32.1],
              backgroundColor: '#FF9F40'
            },
            {
              label: 'Rotation',
              data: [23.3, 20.0, 26.7, 25.0],
              backgroundColor: '#9966FF'
            },
            {
              label: 'Color Issue',
              data: [20.0, 16.7, 13.3, 10.7],
              backgroundColor: '#FFCD56'
            },
            {
              label: 'Background',
              data: [16.7, 16.7, 13.3, 21.4],
              backgroundColor: '#4BC0C0'
            },
            {
              label: 'Other',
              data: [13.3, 16.7, 13.3, 10.7],
              backgroundColor: '#36A2EB'
            }
          ]
        },
        options: {
          responsive: true,
          plugins: {
            legend: { position: 'top' },
            title: { display: true, text: 'Weekly Issue Distribution' }
          },
          scales: {
            x: { stacked: false },
            y: {
              beginAtZero: true,
              title: { display: true, text: 'Percentage' }
            }
          }
        }
      });
      
      // Dashboard charts
      new Chart(document.getElementById('issueChart'), {
        type: 'bar',
        data: {
          labels: ['Image Quality', 'Rotation', 'Color Issue', 'Background', 'Other'],
          datasets: [{
            label: 'Issue Count',
            data: [36, 28, 24, 20, 20],
            backgroundColor: '#007bff'
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: { display: false },
            title: { display: true, text: 'Issue Distribution' }
          }
        }
      });
      
      new Chart(document.getElementById('severityPie'), {
        type: 'pie',
        data: {
          labels: ['Blocker', 'High', 'Low'],
          datasets: [{
            data: [24, 56, 48],
            backgroundColor: ['#FF6384', '#36A2EB', '#4BC0C0']
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: { position: 'right' },
            title: { display: true, text: 'Severity Distribution' }
          }
        }
      });
    });
    
    // Apply filters function
    function applyFilters() {
      alert('Filters applied! In a real application, this would update the dashboard data.');
    }
    
    // Open spin dialog
    function openSpinDialog() {
      document.getElementById('spinModal').style.display = 'flex';
    }
    
    // Navigate spins
    function navigateSpin(direction) {
      alert(`Navigating to ${direction > 0 ? 'next' : 'previous'} spin`);
    }
    
    // Load data from Google Sheets
    const qcSheetUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTaSxWZ-Y3M-wyNiCdN7FSH5kAMMy1cox7D_YRn2sWNkGfo1j4WCGbaedRXgnUKvELK5eAMv334UCaD/pub?gid=0&single=true&output=csv';
    
    let globalData = [];
    let totalDataGlobal = [];
    let rawData = [];

    async function loadAndRender() {
      const [qcData, totalData] = await Promise.all([
        loadCSV('https://docs.google.com/spreadsheets/d/e/2PACX-1vQTc7M9RhXdcyXaJPPgedw4uWSTamAPlokhDyXfDMhPxEbJkd7Ff73QCBaSLmDjLAXGSZNrD_6QlDuD/pub?gid=0&single=true&output=csv'),
        loadCSV('https://docs.google.com/spreadsheets/d/e/2PACX-1vTmm6um2dDueAholFhs2olel5wv2mqH9f1jCAfdL8Qi76mzqbTfzu7OYRea5PwSJP0eD0RLuF6XOkTy/pub?gid=0&single=true&output=csv')
      ]);
      globalData = qcData;
      totalDataGlobal = totalData;
      applyFiltersForDashboard();
    }

    function loadCSV(url) {
      return fetch(url).then(res => res.text()).then(text =>
        new Promise(resolve => {
          Papa.parse(text, {
            header: true,
            skipEmptyLines: true,
            complete: results => resolve(results.data)
          });
        })
      );
    }

    window.onload = async () => {
      await loadAndRender();
      applyFilters();
    };
    
    function applyFiltersForDashboard() {
      // In a real application, this would filter the data
      // and update the dashboard components
    }
    
    function applyFilters() {
      // In a real application, this would filter the data
      // and update the dashboard components
    }
    
    function loadQCReport() {
      // In a real application, this would load QC report data
    }
  </script>
</body>
</html>
