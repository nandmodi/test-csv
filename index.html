<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Live User Tracking</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
    }
    th, td {
      padding: 12px;
      text-align: left;
      border: 1px solid #ddd;
    }
    th {
      background-color: #f2f2f2;
    }
    .live {
      color: green;
    }
    .offline {
      color: red;
    }
  </style>
</head>
<body>

  <h1>User Live Status</h1>
  <table>
    <thead>
      <tr>
        <th>User</th>
        <th>Last Log</th>
        <th>Status</th>
      </tr>
    </thead>
    <tbody id="user-status-table">
      <!-- Data will be populated dynamically -->
    </tbody>
  </table>

  <script>
    const sheetUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSo76L7XI-AHGphJRHyTXCwMVuizeUUfb23MlzOvKRJBXF4JccS_gl5koNEzy6I61crp7dLXYPvYP2W/pub?gid=0&single=true&output=csv';

    // Function to fetch the CSV data from the Google Sheet URL
    async function fetchData() {
      try {
        const response = await fetch(sheetUrl);
        const csvText = await response.text();
        const data = parseCSV(csvText);
        loadUserData(data);
      } catch (error) {
        console.error('Error fetching CSV:', error);
      }
    }

    // Function to parse CSV text into an array of objects
    function parseCSV(csvText) {
      const rows = csvText.split('\n').map(row => row.split(','));
      const headers = rows[0]; // The first row contains column names
      const data = rows.slice(1).map(row => {
        let userData = {};
        headers.forEach((header, index) => {
          userData[header.trim()] = row[index]?.trim();
        });
        return userData;
      });
      return data;
    }

    // Function to check if the user is live based on the last log time and current time
    function checkUserStatus(lastLog) {
      const date1 = new Date(lastLog); // Convert the last log time to a Date object
      const date2 = new Date(); // Get the current time
      const diffMinutes = (date2 - date1) / (1000 * 60); // Difference in minutes
      return diffMinutes <= 7 ? 'ðŸŸ¢' : 'ðŸ”´'; // If less than or equal to 4 minutes, user is live, else offline
    }

    // Function to load and update user data in the table
    function loadUserData(data) {
      const tableBody = document.getElementById('user-status-table');
      data.forEach((user) => {
        const status = checkUserStatus(user['Last Log']); // Check if the user is live based on 'Last Log'
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${user['User']}</td>
          <td>${user['Last Log']}</td>
          <td class="${status === 'ðŸŸ¢' ? 'live' : 'offline'}">${status}</td>
        `;
        tableBody.appendChild(row);
      });
    }

    fetchData(); // Fetch the data when the page loads

  </script>

</body>
</html>
