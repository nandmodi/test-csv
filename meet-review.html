<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Team Review UI</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f4f7fa;
      margin: 0;
      padding: 20px;
    }
    .container {
      max-width: 1200px;
      margin: auto;
      background-color: #ffffff;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 1px 6px rgba(0, 0, 0, 0.1);
    }
    h2 {
      font-size: 1.8em;
      color: #333;
      margin-bottom: 20px;
    }
    .filters {
      margin-bottom: 20px;
      display: flex;
      justify-content: space-between;
      gap: 20px;
    }
    label {
      font-size: 1.1em;
    }
    select {
      padding: 8px;
      font-size: 1em;
      width: 200px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    th, td {
      padding: 10px;
      border: 1px solid #ddd;
      text-align: left;
    }
    th {
      background-color: #007BFF;
      color: white;
    }
    .image-cell img {
      width: 100px;
      height: auto;
    }
  </style>
</head>
<body>

  <div class="container">
    <h2>Team Review Dashboard</h2>

    <!-- Filters Section -->
    <div class="filters">
      <div>
        <label for="date-filter">Date:</label>
        <select id="date-filter"></select>
      </div>
      <div>
        <label for="enterprise-filter">Enterprise:</label>
        <select id="enterprise-filter"></select>
      </div>
      <div>
        <label for="qc-user-filter">QC User:</label>
        <select id="qc-user-filter"></select>
      </div>
      <div>
        <label for="editing-user-filter">Editing User:</label>
        <select id="editing-user-filter"></select>
      </div>
    </div>

    <!-- Data Table -->
    <table id="data-table">
      <thead>
        <tr>
          <th>Date</th>
          <th>Enterprise</th>
          <th>QC User</th>
          <th>SKU ID</th>
          <th>Image ID</th>
          <th>Issue</th>
          <th>Input Image</th>
          <th>AI Image</th>
          <th>Final Image</th>
          <th>Comments</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <script>
    const csvUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSWW7muoNyeY_1VOLhybuT7ChNHtkhAscxDikyiCPQChIWqi1m3KXsd9e0_i_UFE7bDrW_7kfH-vIhL/pub?gid=1880564018&single=true&output=csv";
    
    // Fetch and parse CSV data
    Papa.parse(csvUrl, {
      download: true,
      header: true,
      dynamicTyping: true,
      complete: function(results) {
        const data = results.data;
        
        // Filter options setup
        const dates = [...new Set(data.map(row => row.Timestamp.split('T')[0]))];
        const enterprises = [...new Set(data.map(row => row.Enterprise))];
        const qcUsers = [...new Set(data.map(row => row["qc-user"]))];
        const editingUsers = [...new Set(data.map(row => row["editing user"]))];

        // Populate filter options
        populateFilter('date-filter', dates);
        populateFilter('enterprise-filter', enterprises);
        populateFilter('qc-user-filter', qcUsers);
        populateFilter('editing-user-filter', editingUsers);

        // Populate table with data
        populateTable(data);

        // Filter data based on selected filter values
        document.getElementById('date-filter').addEventListener('change', filterData);
        document.getElementById('enterprise-filter').addEventListener('change', filterData);
        document.getElementById('qc-user-filter').addEventListener('change', filterData);
        document.getElementById('editing-user-filter').addEventListener('change', filterData);

        // Function to populate filter dropdown
        function populateFilter(id, values) {
          const select = document.getElementById(id);
          select.innerHTML = `<option value="">All</option>`;
          values.forEach(value => {
            const option = document.createElement('option');
            option.value = value;
            option.textContent = value;
            select.appendChild(option);
          });
        }

        // Function to populate data table
        function populateTable(data) {
          const tbody = document.querySelector('#data-table tbody');
          tbody.innerHTML = '';
          data.forEach(row => {
            const tr = document.createElement('tr');
            tr.innerHTML = `
              <td>${row.Timestamp.split('T')[0]}</td>
              <td>${row.Enterprise}</td>
              <td>${row["qc-user"]}</td>
              <td>${row["sku_id"]}</td>
              <td>${row["image_id"]}</td>
              <td>${row.Issue}</td>
              <td class="image-cell"><img src="${row["input image"]}" alt="Input Image"></td>
              <td class="image-cell"><img src="${row["ai image"]}" alt="AI Image"></td>
              <td class="image-cell"><img src="${row["final image"]}" alt="Final Image"></td>
              <td>${row.Comment}</td>
            `;
            tbody.appendChild(tr);
          });
        }

        // Function to filter data
        function filterData() {
          const date = document.getElementById('date-filter').value;
          const enterprise = document.getElementById('enterprise-filter').value;
          const qcUser = document.getElementById('qc-user-filter').value;
          const editingUser = document.getElementById('editing-user-filter').value;

          const filteredData = data.filter(row => {
            return (
              (date === "" || row.Timestamp.split('T')[0] === date) &&
              (enterprise === "" || row.Enterprise === enterprise) &&
              (qcUser === "" || row["qc-user"] === qcUser) &&
              (editingUser === "" || row["editing user"] === editingUser)
            );
          });

          populateTable(filteredData);
        }
      }
    });
  </script>
</body>
</html>
