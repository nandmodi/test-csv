<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Team Review UI</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f4f7fa;
      margin: 0;
      padding: 0;
    }

    .container {
      max-width: 1200px;
      margin: auto;
      background: #fff;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 1px 6px rgba(0,0,0,0.1);
    }

    h2 {
      margin-bottom: 20px;
      font-size: 1.75rem;
      border-bottom: 1px solid #e1e4e8;
      padding-bottom: 10px;
    }

    .filters {
      display: flex;
      gap: 20px;
      margin-bottom: 20px;
    }

    .filters label {
      font-size: 1em;
      color: #333;
    }

    .filters select {
      padding: 5px;
      font-size: 1em;
      border: 1px solid #e1e4e8;
      border-radius: 4px;
    }

    .details {
      margin-bottom: 20px;
    }

    .details div {
      font-size: 1em;
      margin-bottom: 10px;
    }

    .images-section {
      display: flex;
      gap: 20px;
      margin-top: 20px;
      flex-wrap: wrap;
    }

    .image-cell {
      width: 200px;
      text-align: center;
      margin-bottom: 20px;
    }

    .image-cell img {
      width: 100%;
      height: auto;
      border-radius: 8px;
    }

    .image-cell h4 {
      font-size: 1.1em;
      color: #333;
      margin-bottom: 5px;
    }
  </style>
</head>
<body>

<div class="container">
  <h2>Team Review</h2>

  <!-- Filter Section -->
  <div class="filters">
    <label for="dateFilter">Date:</label>
    <select id="dateFilter">
      <option value="">Select Date</option>
    </select>

    <label for="enterpriseFilter">Enterprise:</label>
    <select id="enterpriseFilter">
      <option value="">Select Enterprise</option>
    </select>

    <label for="qcUserFilter">QC User:</label>
    <select id="qcUserFilter">
      <option value="">Select QC User</option>
    </select>

    <label for="editingUserFilter">Editing User:</label>
    <select id="editingUserFilter">
      <option value="">Select Editing User</option>
    </select>
  </div>

  <!-- Details Section -->
  <div class="details" id="detailsSection">
    <!-- Data will be populated here -->
  </div>

  <!-- Images Section -->
  <div class="images-section" id="imagesSection">
    <!-- Images will be shown here -->
  </div>
</div>

<script>
  const sheetUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSWW7muoNyeY_1VOLhybuT7ChNHtkhAscxDikyiCPQChIWqi1m3KXsd9e0_i_UFE7bDrW_7kfH-vIhL/pub?gid=1880564018&single=true&output=csv';

  let data = [];

  // Fetch the CSV data from Google Sheets
  Papa.parse(sheetUrl, {
    download: true,
    header: true,
    skipEmptyLines: true,
    complete: function(results) {
      data = results.data;
      populateFilters();
    }
  });

  // Populate filters from the data
  function populateFilters() {
    const dateFilter = document.getElementById('dateFilter');
    const enterpriseFilter = document.getElementById('enterpriseFilter');
    const qcUserFilter = document.getElementById('qcUserFilter');
    const editingUserFilter = document.getElementById('editingUserFilter');

    const dates = [...new Set(data.map(item => item.Timestamp.split(' ')[0]))];
    dates.forEach(date => {
      const option = document.createElement('option');
      option.value = date;
      option.textContent = date;
      dateFilter.appendChild(option);
    });

    const enterprises = [...new Set(data.map(item => item.Enterprise))];
    enterprises.forEach(enterprise => {
      const option = document.createElement('option');
      option.value = enterprise;
      option.textContent = enterprise;
      enterpriseFilter.appendChild(option);
    });

    const qcUsers = [...new Set(data.map(item => item['qc-user']))];
    qcUsers.forEach(qcUser => {
      const option = document.createElement('option');
      option.value = qcUser;
      option.textContent = qcUser;
      qcUserFilter.appendChild(option);
    });

    const editingUsers = [...new Set(data.map(item => item['editing user']))];
    editingUsers.forEach(editingUser => {
      const option = document.createElement('option');
      option.value = editingUser;
      option.textContent = editingUser;
      editingUserFilter.appendChild(option);
    });
  }

  // Filter data based on selected filters
  function filterData() {
    const date = document.getElementById('dateFilter').value;
    const enterprise = document.getElementById('enterpriseFilter').value;
    const qcUser = document.getElementById('qcUserFilter').value;
    const editingUser = document.getElementById('editingUserFilter').value;

    let filteredData = data;

    if (date) {
      filteredData = filteredData.filter(item => item.Timestamp.split(' ')[0] === date);
    }
    if (enterprise) {
      filteredData = filteredData.filter(item => item.Enterprise === enterprise);
    }
    if (qcUser) {
      filteredData = filteredData.filter(item => item['qc-user'] === qcUser);
    }
    if (editingUser) {
      filteredData = filteredData.filter(item => item['editing user'] === editingUser);
    }

    // Filter out rows where Comments are "Done"
    filteredData = filteredData.filter(item => item.Comments !== 'Done');

    displayDetails(filteredData);
    displayImages(filteredData);
  }

  // Display details section
  function displayDetails(dataToDisplay) {
    const detailsSection = document.getElementById('detailsSection');
    detailsSection.innerHTML = '';

    dataToDisplay.forEach(item => {
      const detailDiv = document.createElement('div');
      detailDiv.innerHTML = `
        <div><strong>Enterprise:</strong> ${item.Enterprise}</div>
        <div><strong>QC User:</strong> ${item['qc-user']}</div>
        <div><strong>Editing User:</strong> ${item['editing user']}</div>
        <div><strong>Issue:</strong> ${item.Issue}</div>
        <div><strong>Date:</strong> ${item.Timestamp.split(' ')[0]}</div>
        <div><strong>SKU ID:</strong> ${item['sku_id']}</div>
        <div><strong>Image ID:</strong> ${item['image_id']}</div>
        <div><strong>Comments:</strong> ${item.Comments}</div>
      `;
      detailsSection.appendChild(detailDiv);
    });
  }

  // Display images section
  function displayImages(dataToDisplay) {
    const imagesSection = document.getElementById('imagesSection');
    imagesSection.innerHTML = '';

    dataToDisplay.forEach(item => {
      const imageDiv = document.createElement('div');
      imageDiv.className = 'image-cell';

      imageDiv.innerHTML = `
        <h4>Input Image</h4>
        <img src="${item['input image']}" alt="Input Image">
        <h4>AI Image</h4>
        <img src="${item['Ai image']}" alt="AI Image">
        <h4>Final Image</h4>
        <img src="${item['Final Image']}" alt="Final Image">
      `;

      imagesSection.appendChild(imageDiv);
    });
  }

  // Event listeners for filters
  document.getElementById('dateFilter').addEventListener('change', filterData);
  document.getElementById('enterpriseFilter').addEventListener('change', filterData);
  document.getElementById('qcUserFilter').addEventListener('change', filterData);
  document.getElementById('editingUserFilter').addEventListener('change', filterData);
</script>

</body>
</html>
