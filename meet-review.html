<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google Sheets Data Viewer</title>
    <style>
        body {
            font-family: Arial, sans-serif;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }

        th, td {
            padding: 8px;
            border: 1px solid #ddd;
            text-align: left;
        }

        select, input {
            margin: 10px;
        }

        .image-cell img {
            width: 100px; /* Adjust size */
            height: auto;
        }

    </style>
</head>
<body>

<h2>Google Sheets Data Viewer with Filters</h2>

<!-- Filters -->
<label for="dateFilter">Date:</label>
<input type="date" id="dateFilter">

<label for="enterpriseFilter">Enterprise:</label>
<select id="enterpriseFilter">
    <option value="">Select Enterprise</option>
</select>

<label for="qcUserFilter">QC User:</label>
<select id="qcUserFilter">
    <option value="">Select QC User</option>
</select>

<label for="editingUserFilter">Editing User:</label>
<select id="editingUserFilter">
    <option value="">Select Editing User</option>
</select>

<!-- Table to display data -->
<table id="dataTable">
    <thead>
        <tr>
            <th>Date</th>
            <th>Enterprise</th>
            <th>QC User</th>
            <th>Sku ID</th>
            <th>Image ID</th>
            <th>Issue</th>
            <th>Input Image</th>
            <th>Ai Image</th>
            <th>Final Image</th>
            <th>Comment</th>
            <th>Editing User</th>
        </tr>
    </thead>
    <tbody>
        <!-- Data rows will be dynamically inserted here -->
    </tbody>
</table>

<script>
// Function to fetch data from Google Sheets (CSV link)
async function fetchData() {
    const url = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSWW7muoNyeY_1VOLhybuT7ChNHtkhAscxDikyiCPQChIWqi1m3KXsd9e0_i_UFE7bDrW_7kfH-vIhL/pub?gid=1880564018&single=true&output=csv';
    const response = await fetch(url);
    const data = await response.text();
    parseCSV(data);
}

// Function to parse the CSV data
function parseCSV(data) {
    const rows = data.split('\n').map(row => row.split(','));
    const headers = rows[0];
    const dataRows = rows.slice(1);

    // Update filters dynamically based on data
    updateFilters(dataRows);

    // Display the data in the table
    displayData(dataRows);
}

// Function to update filter options based on the data
function updateFilters(dataRows) {
    const enterpriseFilter = document.getElementById('enterpriseFilter');
    const qcUserFilter = document.getElementById('qcUserFilter');
    const editingUserFilter = document.getElementById('editingUserFilter');

    // Get unique values for each filter
    const enterprises = new Set();
    const qcUsers = new Set();
    const editingUsers = new Set();
    dataRows.forEach(row => {
        enterprises.add(row[1]);
        qcUsers.add(row[2]);
        editingUsers.add(row[9]);
    });

    // Populate filters
    populateSelectFilter(enterpriseFilter, enterprises);
    populateSelectFilter(qcUserFilter, qcUsers);
    populateSelectFilter(editingUserFilter, editingUsers);
}

// Helper function to populate a select filter with unique values
function populateSelectFilter(selectElement, values) {
    values.forEach(value => {
        const option = document.createElement('option');
        option.value = value;
        option.textContent = value;
        selectElement.appendChild(option);
    });
}

// Function to display the filtered data
function displayData(dataRows) {
    const dateFilter = document.getElementById('dateFilter').value;
    const enterpriseFilter = document.getElementById('enterpriseFilter').value;
    const qcUserFilter = document.getElementById('qcUserFilter').value;
    const editingUserFilter = document.getElementById('editingUserFilter').value;

    // Filter the data based on selected filters
    const filteredData = dataRows.filter(row => {
        const dateMatch = dateFilter ? row[0].startsWith(dateFilter) : true;
        const enterpriseMatch = enterpriseFilter ? row[1] === enterpriseFilter : true;
        const qcUserMatch = qcUserFilter ? row[2] === qcUserFilter : true;
        const editingUserMatch = editingUserFilter ? row[9] === editingUserFilter : true;

        return dateMatch && enterpriseMatch && qcUserMatch && editingUserMatch;
    });

    // Clear the current table rows
    const tableBody = document.getElementById('dataTable').getElementsByTagName('tbody')[0];
    tableBody.innerHTML = '';

    // Populate the table with filtered data
    filteredData.forEach(row => {
        const tr = document.createElement('tr');

        row.forEach((cell, index) => {
            const td = document.createElement('td');
            if (index === 6 || index === 7 || index === 8) { // Image columns
                const img = document.createElement('img');
                img.src = cell;
                img.alt = 'Image';
                td.classList.add('image-cell');
                td.appendChild(img);
            } else {
                td.textContent = cell;
            }
            tr.appendChild(td);
        });

        tableBody.appendChild(tr);
    });
}

// Add event listeners to filters
document.getElementById('dateFilter').addEventListener('input', () => fetchData());
document.getElementById('enterpriseFilter').addEventListener('change', () => fetchData());
document.getElementById('qcUserFilter').addEventListener('change', () => fetchData());
document.getElementById('editingUserFilter').addEventListener('change', () => fetchData());

// Fetch and display the data initially
fetchData();
</script>

</body>
</html>
